# 微信格式内容功能说明

## 功能概述

在文章详情页面中新增了"微信格式内容"标签页，支持将文章内容转换为适合微信公众号发布的 HTML 格式，并提供多种主题风格供选择。

## 功能特性

### 1. 多主题支持

提供了 4 种精心设计的主题风格：

- **🎨 简洁清新（default）**
  - 蓝色系配色
  - 适合大多数文章类型
  - 清新简洁的视觉效果

- **💻 现代科技（tech）**
  - 深色代码块
  - 适合技术类文章
  - 代码高亮更清晰

- **📚 严谨学术（academic）**
  - 衬线字体
  - 适合学术论文和正式文档
  - 专业严谨的排版

- **🌿 清新活泼（fresh）**
  - 绿色系配色
  - 适合生活、情感类文章
  - 轻松活泼的氛围

### 2. 实时预览

- 在页面内直接预览微信格式效果
- 支持全屏弹窗查看完整效果
- 支持查看和切换渲染视图与源代码视图
- 自动滚动查看长文章内容

### 3. 便捷操作

- **一键切换主题**：通过下拉菜单即可切换不同主题风格
- **全屏查看**：在弹窗中查看完整的渲染效果
- **查看源代码**：在弹窗中查看 HTML 源代码
- **富文本复制**：复制渲染后的内容，可直接粘贴到微信公众号（类似 Ctrl+C 效果）
- **源码复制**：在源代码视图中可复制纯 HTML 代码

## 使用方法

### 访问微信格式内容

1. 进入文章详情页面
2. 点击"微信格式内容"标签页（带有微信图标）
3. 系统会自动加载默认主题的微信格式内容

### 切换主题

1. 在主题选择下拉框中选择想要的主题
2. 系统会自动重新加载该主题的内容
3. 预览区会实时更新显示效果

### 全屏查看和复制内容

1. 点击"全屏查看"按钮打开弹窗
2. 在弹窗中可以看到完整的渲染效果
3. 点击"复制内容"按钮，内容会以富文本格式复制（类似 Ctrl+C）
4. 直接粘贴到微信公众号后台，保留所有格式和样式

### 查看和复制源代码

1. 点击"查看源代码"按钮
2. 在弹窗中可以查看 HTML 源代码
3. 点击"复制源码"按钮可复制纯 HTML 代码
4. 适合需要自定义修改的高级用户

## API 接口

### 获取微信格式内容

```
GET /api/v1/articles/{articleId}/content?format=wechat_html&wechat_theme={theme}
```

**参数说明：**
- `articleId`: 文章 ID
- `format`: 内容格式，固定为 `wechat_html`
- `wechat_theme`: 主题名称，可选值：`default`、`tech`、`academic`、`fresh`

**响应示例：**
```json
{
  "success": true,
  "message": "获取成功",
  "data": {
    "content": "<html>...",
    "format": "wechat_html",
    "article_id": "68e67af174dc3bab3f5ebdb2"
  }
}
```

## 技术实现

### 核心组件

1. **WechatHtmlRenderer**
   - 位置：`src/components/ui/WechatHtmlRenderer.tsx`
   - 功能：渲染微信格式 HTML 内容
   - 特性：
     - 主题选择
     - 全屏查看弹窗（与其他标签页保持一致的交互方式）
     - 渲染视图与源代码视图切换
     - 富文本复制（类似 Ctrl+C 效果）
     - HTML 源码复制

2. **类型定义**
   - 位置：`src/types/article.ts`
   - 新增类型：`WechatTheme`
   - 新增常量：`WECHAT_THEME_OPTIONS`
   - 扩展类型：`ArticleContentFormat` 增加 `wechat_html`

3. **服务层更新**
   - 位置：`src/services/article.ts`
   - 更新方法：`getArticleContent` 支持 `wechatTheme` 参数

### 状态管理

在 `ArticleDetail.tsx` 中新增：
- `wechatTheme`: 当前选中的微信主题
- `wechatContentLoading`: 微信内容加载状态
- `contents.wechat_html`: 微信格式 HTML 内容

## 注意事项

1. **内容加载**
   - 微信格式内容会在文章详情页加载时自动获取
   - 切换主题时会重新请求服务器
   - 确保文章已采集才能查看微信格式内容

2. **浏览器兼容性**
   - 富文本复制功能使用 `document.execCommand('copy')`，兼容性较好
   - 源码复制使用 Clipboard API
   - 建议使用现代浏览器（Chrome、Firefox、Edge 等）以获得最佳体验

3. **性能优化**
   - 微信格式内容仅在切换到对应标签页时才会加载
   - 切换主题时会显示加载状态
   - 内容会被缓存，避免重复加载

## 未来扩展

可能的功能扩展方向：
- [ ] 支持自定义主题配色
- [ ] 提供主题预览缩略图
- [ ] 支持导出为独立 HTML 文件
- [ ] 添加更多主题风格
- [ ] 支持主题收藏功能

